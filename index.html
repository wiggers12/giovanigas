<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gigas</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ESTILOS UNIFICADOS (LOGIN, APP, CATÁLOGO) */
        :root {
            --gigas-blue: #004AAD; --gigas-blue-light: #E0F2FE; --gigas-blue-dark: #00307A;
            --gigas-red: #D93025; --bg-light: #F4F6F9; --bg-dark-card: #FFFFFF;
            --text-primary: #222222; --text-secondary: #666666; --border-color: #DDDDDD;
            --shadow: 0 4px 10px rgba(0,0,0,0.1); --border-radius: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        main { display: none; } /* Esconde o main até o splash terminar */

        /* ===== SPLASH SCREEN (DO SEU CÓDIGO ORIGINAL) ===== */
        #splashScreen { position: fixed; inset: 0; display:flex; flex-direction:column; align-items:center; justify-content:center; background: linear-gradient(135deg,#3a7dff,#5c9bff); color:#fff; z-index:9999; transition: opacity 1s ease; text-align:center; padding: 24px; }
        #splashScreen i { font-size:4rem; margin-bottom:18px; animation:bounce 1.6s infinite; }
        #splashScreen h1 { font-size:2.6rem; font-weight:800; letter-spacing:2px; text-transform:uppercase; }
        @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }

        /* Estilos do Login e Seções */
        .login-body-wrapper { display: flex; align-items: center; justify-content: center; min-height: 100vh; background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.6s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--bg-dark-card); padding: 30px; border-radius: var(--border-radius); border: 1px solid var(--border-color); box-shadow: var(--shadow); }
        /* Cole aqui o resto dos seus estilos de form-group, button, etc, para a tela de login */
        #promoSection { display: none; margin-bottom: 25px; text-align: center; transition: opacity 0.5s ease-in; opacity: 0; }
        #promoImage { width: 100%; max-height: 200px; object-fit: cover; border-radius: 12px; box-shadow: var(--shadow); }
        .toggle-form { text-align: center; margin-top: 20px; color: var(--text-secondary); }
        .toggle-form span { color: var(--gigas-blue); font-weight: 700; cursor: pointer; text-decoration: underline; }

        /* Estilos da Home Section Reestruturada */
        #homeSection .home-container { display: flex; gap: 30px; height: 100vh; }
        #homeSection .home-sidebar { width: 320px; padding: 30px; overflow-y: auto; }
        #homeSection .home-main-content { flex-grow: 1; padding: 30px; overflow-y: auto; background-color: var(--bg-light); }
        .nav-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .nav-card { background: var(--bg-dark-card); padding: 20px; border-radius: var(--border-radius); text-align: center; font-weight: 700; color: var(--text-primary); cursor: pointer; border: 1px solid var(--border-color); transition: all 0.3s ease-in-out; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .nav-card:hover { transform: scale(1.05); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .nav-card i { font-size: 2rem; margin-bottom: 10px; }
        .nav-card span { font-size: 1.1rem; }
        .card-cliente { background-color: var(--gigas-blue); color: #FFFFFF; }
        .card-pedido { background-color: var(--gigas-blue-light); color: var(--gigas-blue); }

        /* Estilos do Catálogo (Toast, Modal, Carrinho) */
        .toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 8px; background: var(--gigas-blue); color: white; box-shadow: var(--shadow); font-weight: 500; transition: all 0.5s ease-in-out; opacity: 0; z-index: 1000; }
        .toast.show { bottom: 30px; opacity: 1; }
        .toast.error { background: var(--gigas-red); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 999; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 20px rgba(0,0,0,0.2); max-width: 500px; width: 90%; transform: scale(0.9); opacity: 0; transition: transform 0.3s ease-out, opacity 0.3s ease-out; }
        .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }
        #carrinho-flutuante { position: fixed; bottom: 2rem; right: 2rem; background-color: var(--gigas-blue); color: white; padding: 1rem; border-radius: 9999px; cursor: pointer; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); transition: all 0.2s; z-index: 998;}
        #carrinho-flutuante:hover { transform: scale(1.1); background-color: var(--gigas-blue-dark); }
        #contador-carrinho { position: absolute; top: -5px; right: -5px; background-color: var(--gigas-red); color: white; font-size: 0.75rem; font-weight: bold; padding: 0.25rem 0.5rem; border-radius: 9999px; }
    </style>
</head>
<body>

    <div id="splashScreen" aria-hidden="true">
        <i class="fas fa-truck-moving" aria-hidden="true"></i>
        <h1>Gigas</h1>
    </div>

    <main>
        <section id="loginSection" class="section login-body-wrapper">
            <div class="card" style="width: 420px;">
                <div class="card-header">
                    <h2>Bem-vindo à Gigas!</h2>
                    <p id="loginMessage">Sua gestão de entregas começa aqui.</p>
                </div>
                <div id="promoSection"><img id="promoImage" src="" alt="Promoção do dia" /></div>
                <form id="loginForm">
                    <div class="form-group"><label for="loginEmail">E-mail</label><input type="email" id="loginEmail" required></div>
                    <div class="form-group"><label for="loginPassword">Senha</label><input type="password" id="loginPassword" required></div>
                    <button type="submit">Entrar</button>
                </form>
                <p class="toggle-form">Não tem uma conta? <span id="showRegister">Registre-se</span></p>
            </div>
        </section>

        <section id="registerSection" class="section login-body-wrapper">
             <div class="card" style="width: 420px;"></div>
        </section>

        <section id="homeSection" class="section">
            <div class="home-container">
                <aside class="home-sidebar">
                    <div class="card-header text-center mb-8">
                        <h2 id="welcomeMessage" class="text-2xl font-bold">Bem-vindo</h2>
                        <p class="text-gray-500">Selecione uma opção</p>
                    </div>
                    <div class="nav-grid">
                        <a class="nav-card card-cliente" href="clientes.html"><i class="fas fa-users"></i><span>Clientes</span></a>
                        <a class="nav-card card-pedido" href="pedidos.html"><i class="fas fa-receipt"></i><span>Pedidos</span></a>
                        </div>
                    <button id="logoutBtn" class="w-full mt-8 bg-red-500 text-white p-3 rounded-lg font-semibold hover:bg-red-600">Sair</button>
                </aside>
                
                <main class="home-main-content">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">Catálogo de Produtos</h2>
                    <div id="produtosGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                        </div>
                </main>
            </div>
        </section>
    </main>

    <div id="carrinho-flutuante" style="display: none;">
        <i class="fas fa-shopping-cart text-2xl"></i>
        <span id="contador-carrinho" class="font-mono">0</span>
    </div>
    <div id="carrinhoModal" class="modal-overlay">
        <div class="modal-content"></div>
    </div>

    <script type="module">
        // Importações do Firebase e Funções
        import { auth, db } from './js/firebase.js'; 
        import { signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { collection, doc, setDoc, getDoc, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        // --- LÓGICA DA APLICAÇÃO (CLASSE APP ORIGINAL) ---
        class App {
            constructor() { this.cacheDOMElements(); this.setupEventListeners(); this.initAuthObserver(); }
            cacheDOMElements() {
                this.loginSection = document.getElementById("loginSection");
                this.registerSection = document.getElementById("registerSection");
                this.homeSection = document.getElementById("homeSection");
                this.welcomeMessage = document.getElementById("welcomeMessage");
            }
            setupEventListeners() {
                document.getElementById("loginForm").addEventListener("submit", this.handleLogin.bind(this));
                // Adicione aqui o listener do form de registro
                document.getElementById("logoutBtn").addEventListener("click", () => signOut(auth));
                document.getElementById("showRegister").addEventListener("click", () => this.showSection(this.registerSection));
                document.getElementById("showLogin").addEventListener("click", () => this.showSection(this.loginSection));
            }
            showSection(section) {
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                section.classList.add('active');
            }
            showToast(message, type = 'success') { /* Sua função showToast aqui */ }
            async handleLogin(e) { /* Sua função handleLogin aqui */ }
            async handleRegister(e) { /* Sua função handleRegister aqui */ }
            initAuthObserver() {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        const userDoc = await getDoc(doc(db, "clientes", user.uid));
                        if (userDoc.exists()) { this.welcomeMessage.textContent = `Olá, ${userDoc.data().nome.split(' ')[0]}!`; }
                        this.showSection(this.homeSection);
                        carrinhoFlutuante.style.display = 'flex';
                    } else {
                        this.showSection(this.loginSection);
                        carrinhoFlutuante.style.display = 'none';
                    }
                });
            }
        }
        new App();

        // --- LÓGICA DA PROMOÇÃO E MENSAGENS (ORIGINAL) ---
        const loginMessageEl = document.getElementById('loginMessage');
        const promoSectionEl = document.getElementById('promoSection');
        const promoImageEl = document.getElementById('promoImage');
        // Cole aqui a lógica das mensagens rotativas e do onSnapshot da promoção...

        // --- LÓGICA DO CATÁLOGO E CARRINHO (INTEGRADA) ---
        const cart = [];
        // Cole aqui todas as variáveis e funções do seu catálogo:
        // const carrinhoLista = ...
        // function adicionarAoCarrinho(...)
        // function removerDoCarrinho(...)
        // function atualizarCarrinhoUI(...)
        // ... e os event listeners do carrinho e do modal.
        
        // Observador dos produtos
        onSnapshot(collection(db, "produtos"), (snapshot) => {
            const produtosGrid = document.getElementById("produtosGrid");
            if (!produtosGrid) return;
            produtosGrid.innerHTML = '';
            snapshot.forEach(doc => {
                const p = doc.data();
                const card = document.createElement('div');
                card.className = "bg-white rounded-xl shadow-lg p-4 flex flex-col items-center hover:shadow-xl transition-all duration-300";
                card.innerHTML = `<img src="${p.imagem}" ... ><h3 ... >${p.nome}</h3> ...`; // Seu card de produto
                card.querySelector('.add-to-cart-btn').addEventListener('click', () => adicionarAoCarrinho({ id: doc.id, ...p }));
                produtosGrid.appendChild(card);
            });
        });
    </script>
    
    <script>
        window.addEventListener("load", () => {
            const splash = document.getElementById("splashScreen");
            const main = document.querySelector("main");
            setTimeout(() => {
                splash.style.opacity = "0";
                setTimeout(() => {
                    splash.style.display = "none";
                    main.style.display = "block";
                }, 1000);
            }, 2000); // Reduzi para 2 segundos
        });
    </script>
</body>
</html>
